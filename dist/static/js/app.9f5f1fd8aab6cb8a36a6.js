webpackJsonp([1],{EwTW:function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n("7+uW"),r=n("5dBV"),i=n.n(r),a=n("mvHQ"),u=n.n(a),c="http://localhost:3333";function o(t,e){return fetch(c+"/"+t,{method:"post",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"},body:u()(e)}).then(function(t){return t.json()}).catch(function(t){return console.error(t)})}function d(t){return fetch(c+"/"+t).then(function(t){return t.json()}).catch(function(t){return console.error(t)})}var l={name:"App",data:function(){return{userName:"",user:{},breads:[],nextUpdate:Number,secondsRemaining:59,timer:null}},mounted:function(){var t=this,e=localStorage.getItem("userId");e&&this.updateUser(e),this.updateBreads(),this.timer=setInterval(function(){var e=(new Date).getTime();t.secondsRemaining=-Math.round((e-t.nextUpdate)/1e3),t.secondsRemaining<=0&&t.updateBreads()},200)},beforeDestroy:function(){clearInterval(this.timer)},methods:{formatFinancial:function(t){return i()(t).toFixed(2)},createUser:function(t){var e=this;o("user",{username:t}).then(function(t){e.user=t,t.id&&localStorage.setItem("userId",t.id)})},updateUser:function(t){var e=this;d("user/"+t).then(function(t){return e.user=t})},updateBreads:function(){var t=this;d("breads").then(function(e){var n=(new Date).getTime();t.nextUpdate=n+e.nextUpdate,t.breads=e.breads})},buy:function(t){var e=this;o("buy",{userId:this.user.id,purchases:[{id:t.id,qty:1}]}).then(function(n){n.purchases.forEach(function(n){e.breads.find(function(t){return t.id===n.id})&&(t.qty=n.qty)}),e.updateUser(e.user.id)})},sell:function(t){var e=this;o("sell",{userId:this.user.id,id:t.id,qty:1}).then(function(t){e.user.credits=t.credits,e.user.items=t.items,e.updateBreads()})}},computed:{myItems:function(){var t=this;if(this.breads.length&&this.user.items)return this.user.items.map(function(e){var n=t.breads.find(function(t){return t.id===e.id});return{qty:e.qty,name:n.name,price:t.formatFinancial(n.price),id:n.id}})},timeLeftStyles:function(){if(this.secondsRemaining<10)return{color:"red"}}}},m={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"breadmarket",attrs:{id:"app"}},[t.user.id?n("div",[n("p",[t._v("Hello, "+t._s(t.user.name)+"!")]),t._v(" "),n("div",{staticClass:"tables-container"},[n("div",[n("h2",[t._v("Bread market")]),t._v(" "),n("p",{staticClass:"small-font"},[t._v("Click on an item to buy")]),t._v(" "),n("div",{staticClass:"scroll-wrapper"},[n("table",{staticClass:"table",staticStyle:{"text-align":"left"}},[t._m(0),t._v(" "),t._l(t.breads,function(e,s){return n("tr",{key:s,on:{click:function(n){t.buy(e)}}},[n("td",[t._v(t._s(e.qty))]),t._v(" "),n("td",[t._v(t._s(e.name))]),t._v(" "),n("td",[t._v(t._s(t.formatFinancial(e.price))+" €")])])})],2)])]),t._v(" "),n("div",[n("h2",[t._v("Your items")]),t._v(" "),n("p",{staticClass:"small-font"},[t._v("Click on an item to sell")]),t._v(" "),n("div",{staticClass:"scroll-wrapper"},[n("table",{staticClass:"table items",staticStyle:{"text-align":"left"}},[t._m(1),t._v(" "),t._l(t.myItems,function(e,s){return n("tr",{key:s,on:{click:function(n){t.sell(e)}}},t._l(Object.values(e),function(e){return n("td",{key:e.id},[t._v("\n                "+t._s(e)+"\n              ")])}))})],2)]),t._v(" "),n("p",{staticClass:"credits"},[t._v("You have "+t._s(t.formatFinancial(t.user.credits))+" €")])])]),t._v(" "),n("p",{staticClass:"timer",style:t.timeLeftStyles},[t._v("\n      The market day ends in "+t._s(t.secondsRemaining)+" seconds")])]):n("form",[n("label",{attrs:{for:"username"}},[t._v("Enter a user name")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.userName,expression:"userName"}],attrs:{id:"username"},domProps:{value:t.userName},on:{input:function(e){e.target.composing||(t.userName=e.target.value)}}}),t._v(" "),n("button",{on:{click:function(e){e.preventDefault(),t.createUser(t.userName)}}},[t._v("Create user")])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("th",[this._v("Qty")]),this._v(" "),e("th",[this._v("Bread")]),this._v(" "),e("th",[this._v("Price")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("th",[this._v("Qty")]),this._v(" "),e("th",[this._v("Bread")]),this._v(" "),e("th",[this._v("Price")])])}]};var v=n("VU/8")(l,m,!1,function(t){n("EwTW")},null,null).exports;s.a.config.productionTip=!1,new s.a({el:"#app",components:{App:v},template:"<App/>"})}},["NHnr"]);
//# sourceMappingURL=app.9f5f1fd8aab6cb8a36a6.js.map